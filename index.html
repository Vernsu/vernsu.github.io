<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/rss.xml" title="Swift学徒" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="笨办法学Swift">
<meta property="og:type" content="website">
<meta property="og:title" content="Swift学徒">
<meta property="og:url" content="http://swift.diagon.me/index.html">
<meta property="og:site_name" content="Swift学徒">
<meta property="og:description" content="笨办法学Swift">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift学徒">
<meta name="twitter:description" content="笨办法学Swift">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://swift.diagon.me/"/>





  <title> Swift学徒 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2d1b9ca1ddd64ef2206b43ea10ec9d25";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Swift学徒</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">笨办法学Swift</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-6/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-6/" itemprop="url">
                  AsyncDisplayKit 教程(6)：多方向的智能预加载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T00:00:00+08:00">
                2017-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="多方向的智能预加载"><a href="#多方向的智能预加载" class="headerlink" title="多方向的智能预加载"></a>多方向的智能预加载</h2><p>ASDK 支持多方向的智能预加载。也就是说可以在垂直方向上滚动 table，当 cell 来到屏幕上的某个位置时，cell 会包含一个水平滚动的 Collection View。</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fd3mf2sxc6g30i20bau13.gif" alt=""></p>
<p>虽然 Collection View 明显已经位于可见区域，但你并不想将整个 Collection View 都加载。为此，你可以让每个 Scroll View 分别拥有各自的 ASRangeController，每个 ASRangeController 的 Range Tuning Parameters 是分开配置的。</p>
<p>现在你已经完成了 AnimalTableController，你可以把它作为 ASPageNode 中的一页来使用。</p>
<p>打开 AppDelegate.m，将这句代码:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AnimalTableController *vc = [[AnimalTableController alloc] initWithAnimals:[RainforestCardInfo allAnimals]];</div></pre></td></tr></table></figure>
<p>替换为</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AnimalPagerController *vc = [[AnimalPagerController alloc] init];</div></pre></td></tr></table></figure>
<p>然后打开 AnimalPagerController.m 在构造函数中 return 语句之前加入代码。你所需要做的仅仅是创建一个新的 pager，并将它作为 View Controller 的数据源：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">_pagerNode = [[ASPagerNode alloc] init];</div><div class="line">_pagerNode.dataSource = <span class="keyword">self</span>;</div><div class="line">```   </div><div class="line">Pager Node 实际上是一个配置好的 ASCollectionNode 子类，这和 <span class="built_in">UIPageViewController</span> 的用法是一样的。</div><div class="line"></div><div class="line">接下来你必须实现 Pager 的数据源方法。</div><div class="line"></div><div class="line">实现 `numberOfPagesInPagerNode:`  方法：</div><div class="line"></div><div class="line">```objc</div><div class="line">- (<span class="built_in">NSInteger</span>)numberOfPagesInPagerNode:(ASPagerNode *)pagerNode &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.animals.count;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现 <code>pagerNode:nodeAtIndex:</code>方法，这和早先你实现过的 ASTableNode 方法很像：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (ASCellNode *)pagerNode:(ASPagerNode *)pagerNode nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</div><div class="line">  <span class="comment">//1</span></div><div class="line">  <span class="built_in">CGSize</span> pagerNodeSize = pagerNode.bounds.size;</div><div class="line">  <span class="built_in">NSArray</span> *animals = <span class="keyword">self</span>.animals[index];</div><div class="line"></div><div class="line">  <span class="comment">//2</span></div><div class="line">  ASCellNode *node = [[ASCellNode alloc] initWithViewControllerBlock:^&#123;</div><div class="line">    <span class="keyword">return</span> [[AnimalTableController alloc] initWithAnimals:animals];</div><div class="line">  &#125; didLoadBlock:<span class="literal">nil</span>];</div><div class="line"></div><div class="line">  <span class="keyword">return</span> node;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码解释如下：</p>
<ol>
<li>需要先获取一个数据模型。</li>
<li>你用到的是强大的 <code>initWithViewControllerBlock:</code> 构造方法。你需要提供一个闭包，在这个块闭包中返回你前面已经做好的 Table Node Controller，这样它的 View 会自动用作每一页的 View。酷！</li>
</ol>
<p>这样就拥有一个完整的 Pager 了，它的 cell 来自于你前面完成的那个 Table Node Controller。它拥有二维的预加载，用户可以从水平、垂直两个方向滚动。   </p>
<h2 id="总述"><a href="#总述" class="headerlink" title="总述"></a>总述</h2><p>完整的 AsyncDisplayKit 2.0 教程项目，从<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/AsyncDisplayKit-Finished-3.zip" target="_blank" rel="external">这里</a>下载。如果你想看 Swift 版的，也可以从<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/RainForestSwift.zip" target="_blank" rel="external">这里</a>下载。</p>
<p>如果在进入第二部分之前想学习更多的内容，你可以浏览 AsyncDisplayKit 的官方主页，并查看它的文档。Scott Goodson (AsyncDisplayKit 的原作者) 也会发表一些你感兴趣的文字，它们按时间顺序罗列在这个地方：<a href="http://asyncdisplaykit.org/docs/resources.html" target="_blank" rel="external">AsyncDisplayKit.org Resources</a>。</p>
<p>你可能会对 <a href="https://www.youtube.com/watch?v=OiY1cheLpmI" target="_blank" rel="external">Building Paper 大事记</a> 感兴趣。尽管它还没有被开源，并且还有许多东西会变化，但在它才开始的时候就关注它仍然是一件很有意思的事情。                   </p>
<p>接下来，我们会讲到，如何利用 ASDK 2.0 强大的布局系统。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-5/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-5/" itemprop="url">
                  AsyncDisplayKit 教程(5)：智能预加载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-27T00:00:00+08:00">
                2017-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="预加载的使用"><a href="#预加载的使用" class="headerlink" title="预加载的使用"></a>预加载的使用</h3><p>你可能曾经写过这样的 App ：根据 ScrollView /PageView 的滚动来提前加载数据。比如一个全屏的图片浏览器，总是提前加载下几张图片，这样你的用户基本不会看到空白图片。 如果你想写这样一个程序，你会发现需要考虑的东西太多了。</p>
<p>之前我们说， ASRangeController 会魔法，现在我们解释一下。</p>
<p>在每个容器类中，每个 node 都会有一个“界面状态”的概念。在任何给定的时刻，一个 node 都会处于下列状态：</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1fd33jhb46qj30fy0zuahb.jpg" alt=""></p>
<ul>
<li>Preload Range: 这个位置距离“可见”最远。这时 cell 中的所有 subnode 的内容，比如 ASNetworkImageNode 需要从外部数据源、API 或本地缓存中下载内容。以 batch fetching 为例，这个时候应当抓取模型对象。</li>
<li>Display Range: 处于这个位置的时候，将进行显示操作，比如绘制文本和图片解码。</li>
<li>Visible Range: 处于这个位置的时候，node 至少在屏幕上有一个像素。</li>
</ul>
<p>这些 Range 都能以“整屏”的方式度量，还可以轻易地通过 ASRangeTuningParameters 属性进行调整。</p>
<p>例如，如果你用一个 ASNetworkImageNode 来显示一页图片。当每一页进入 Preload Range 位置时，都要从网络请求数据，而当它进入 Display Range 位置时又会对已经下载的图片进行解码。</p>
<p>通常，如果你不愿意，你可以不考虑这些 Range。它们已经内置了，比如 ASNetworkImageNode 和 ASTextNode。</p>
<h3 id="Node-界面状态-Callbacks"><a href="#Node-界面状态-Callbacks" class="headerlink" title="Node 界面状态 Callbacks"></a>Node 界面状态 Callbacks</h3><p>每个 node 都有一个 interfaceState 属性，它是一个 “bitfield” (NS_OPTION) 类型 ASInterfaceState。因为 ASCellNode 在 Scroll View 中滚动时，Scroll View 是受 ASRangeController 管理的，每个subnode 都会适时改变它的 interfaceState 属性。这样，即使层次最深的那个 node 也可以根据 interfaceState 的改变做出反应。</p>
<p>幸运的是，几乎不需要直接操纵 node 的 interfaceState 属性。通常，需要对节点的状态改变进行响应即可。也就是所谓的 界面状态 Callbacks。</p>
<h4 id="对-node-进行命名"><a href="#对-node-进行命名" class="headerlink" title="对 node 进行命名"></a>对 node 进行命名</h4><p>为了明白节点的状态是怎样变化的，我们需要给它命名。这样，你就可以看到节点是什么时候加载数据，显示内容，进入屏幕，以及它离开时的逆过程。</p>
<p>找到 <code>tableNode:nodeBlockForRowAtIndexPath:</code> 方法中的这个注释：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//You'll add something extra here later...</span></div></pre></td></tr></table></figure>
<p>在注释的下面，加入下句，给每个 cell 一个 debugName 值。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cardNode.debugName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"cell %zd"</span>, indexPath.row];</div></pre></td></tr></table></figure>
<p>现在可以跟踪到每个 cell 进入不同范围的变化过程。</p>
<h4 id="观察-Cell"><a href="#观察-Cell" class="headerlink" title="观察 Cell"></a>观察 Cell</h4><p>打开 CardNode_InterfaceCallbacks.m。这里有 6 个方法，这些方法用来打印节点进入各种范围的过程。取消注释，运行程序，慢慢滚动界面。同时，观察 cell 状态的改变。</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fd340ce8e8g30da09y7wl.gif" alt=""></p>
<p>注意：大部分情况下，你只需要用到两个关于 ASInterfaceState 的改变方法：<code>didEnterVisibleState</code> 和 <code>didExitVisibleState</code>。也就是说，大量底层的工作已经为你完成了。要想知道什么时候需要用到 Preload 和 Display 状态，请看 ASNetworkImageNode 的源代码。所有的 Network Image Node 都会自动抓取和解码，以及释放内存。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-4/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-4/" itemprop="url">
                  AsyncDisplayKit 教程(4)：Batch Fetching
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T00:00:00+08:00">
                2017-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用-Batch-Fetching-进行无限滚动"><a href="#使用-Batch-Fetching-进行无限滚动" class="headerlink" title="使用 Batch Fetching 进行无限滚动"></a>使用 Batch Fetching 进行无限滚动</h3><p>每个 App 都会采用某些机制，保证用户浏览到当前列表结尾时，可以从服务器上拉取新的数据。通常通过 ScrollView 的 delegate 方法 <code>scrollViewDidScroll:</code>  监听 content<br> offset 来进行处理。在 ASDK 中，只需要指定：需要提前多少页时请求数据。</p>
<p>取消 AnimalTableController.m 中 Helpers 类别中的两个方法注释。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AnimalTableController</span> (<span class="title">Helpers</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)retrieveNextPageWithCompletion:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span> *))block &#123;</div><div class="line">  <span class="built_in">NSArray</span> *moreAnimals = [[<span class="built_in">NSArray</span> alloc] initWithArray:[<span class="keyword">self</span>.animals subarrayWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">5</span>)] copyItems:<span class="literal">NO</span>];</div><div class="line">  </div><div class="line">  <span class="comment">// Important: this block must run on the main thread</span></div><div class="line">  <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">    block(moreAnimals);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)insertNewRowsInTableNode:(<span class="built_in">NSArray</span> *)newAnimals &#123;</div><div class="line">  <span class="built_in">NSInteger</span> section = <span class="number">0</span>;</div><div class="line">  <span class="built_in">NSMutableArray</span> *indexPaths = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">  </div><div class="line">  <span class="built_in">NSUInteger</span> newTotalNumberOfPhotos = <span class="keyword">self</span>.animals.count + newAnimals.count;</div><div class="line">  <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> row = <span class="keyword">self</span>.animals.count; row &lt; newTotalNumberOfPhotos; row++) &#123;</div><div class="line">    <span class="built_in">NSIndexPath</span> *path = [<span class="built_in">NSIndexPath</span> indexPathForRow:row inSection:section];</div><div class="line">    [indexPaths addObject:path];</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  [<span class="keyword">self</span>.animals addObjectsFromArray:newAnimals];</div><div class="line">  [<span class="keyword">self</span>.tableNode insertRowsAtIndexPaths:indexPaths withRowAnimation:<span class="built_in">UITableViewRowAnimationNone</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>retrieveNextPageWithCompletion:</code> 方法中可以进行网络调用，而 <code>insertNewRowsInTableNode:</code> 将新的数据添加到 table 中。</p>
<p>在 <code>viewDidLoad:</code> 方法中加入：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableNode.view.leadingScreensForBatching = <span class="number">1.0</span>;  <span class="comment">// 默认值是 2.0</span></div></pre></td></tr></table></figure>
<p>将 leadingScreensForBatching 设置为 1.0 表示当用户滚动还剩 1 个全屏就到达页尾时，开始抓取新的一批数据。</p>
<p>在 Delegate 类别中加入这个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)shouldBatchFetchForTableNode:(ASTableNode *)tableNode &#123;</div><div class="line">  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个方法告诉表格，在这次批抓取之后是否还可以进行新的批抓取。如果你知道 API 上的数据什么时候结束，返回 NO，表示不用进行新的批抓取了。</p>
<p>然后，继续加入：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)tableNode:(ASTableNode *)tableNode willBeginBatchFetchWithContext:(ASBatchContext *)context &#123;</div><div class="line">  <span class="comment">//1</span></div><div class="line">  [<span class="keyword">self</span> retrieveNextPageWithCompletion:^(<span class="built_in">NSArray</span> *animals) &#123;</div><div class="line">    <span class="comment">//2</span></div><div class="line">    [<span class="keyword">self</span> insertNewRowsInTableNode:animals];</div><div class="line"></div><div class="line">    <span class="comment">//3</span></div><div class="line">    [context completeBatchFetching:<span class="literal">YES</span>];</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个方法在用户即将滚动到 table 末尾并且 <code>shouldBatchFetchForTableNode:</code> 方法返回 YES 时被调用。<br>代码解释：</p>
<ol>
<li>请求一次新批抓取，以备显示。通常这会从 API 返回一个对象数组。</li>
<li>在完成块中，用新数据刷新表格。</li>
<li>调用 <code>completeBatchFetching:</code> ，YES 表示你已经完成这个批次。在本批次抓取完成之前，不会进行新的批次抓取。</li>
</ol>
<p>运行程序，可以无限滚动。 </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-3/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-3/" itemprop="url">
                  AsyncDisplayKit 教程(3)：TableNode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-25T00:00:00+08:00">
                2017-02-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本教程的初始工程 RainforestStarter 可以点<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/AsyncDisplayKit-Starter-3.zip" target="_blank" rel="external">这里</a>获取。</p>
<p>运行程序，App 中包含了一个 UITableView，显示了一个野生动物的列表。滚动页面，帧率开始下降。这个 App 明显的需要进行性能上调优。</p>
<h3 id="用-TableNode-替换-Table-View"><a href="#用-TableNode-替换-Table-View" class="headerlink" title="用 TableNode 替换 Table View"></a>用 TableNode 替换 Table View</h3><p>在 AnimalTableController.m 中引入 AsyncDisplayKit：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;AsyncDisplayKit/AsyncDisplayKit.h&gt;</span></span></div></pre></td></tr></table></figure>
<p>将 tableView 属性声明：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UITableView</span> *tableView;</div></pre></td></tr></table></figure>
<p>替换为 tableNode:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) ASTableNode *tableNode;</div></pre></td></tr></table></figure>
<p>这会导致许多代码出现错误，这些错误会引导你去完成整个转换。</p>
<p>我们需要将所有的 tableView 实例修改为 tableNode，其中注意这些地方：</p>
<ol>
<li>将一个 ASTableNode 实例分配给 tableNode。</li>
<li>ASTableNode 对象没有 <code>registerCalss: forCellReuseIdentifier</code> 方法。</li>
<li>你不能将 node 添加为一个 subview。</li>
</ol>
<p>将 <code>viewDidLoad</code> 方法修改为：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.tableNode = [[ASTableNode alloc]initWithStyle:<span class="built_in">UITableViewStylePlain</span>];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.view addSubnode:<span class="keyword">self</span>.tableNode];</div><div class="line">    [<span class="keyword">self</span> wireDelegation];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> applyStyle];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里，我们调用它了 UIVIew 的 <code>addSubnode:</code> 方法，这个方法是通过 Category 的方式被添加到 UIView 上的。它实际上等于：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.tableNode.view];</div></pre></td></tr></table></figure>
<p>修改 <code>viewWillLayoutSubviews</code> 方法，将 self.tableView 替换为 self.tableNode :</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewWillLayoutSubviews &#123;</div><div class="line">  [<span class="keyword">super</span> viewWillLayoutSubviews];</div><div class="line"></div><div class="line">  <span class="keyword">self</span>.tableNode.frame = <span class="keyword">self</span>.view.bounds;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>修改 <code>applyStyle</code> 方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)applyStyle &#123;</div><div class="line">  <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</div><div class="line">  <span class="keyword">self</span>.tableNode.view.separatorStyle = <span class="built_in">UITableViewCellSeparatorStyleNone</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了设置 tableView 的 separatorStyle 属性，我们必须访问 tableNode 的 view 属性。ASTableNode 并没有将 UITableView 的所有属性都暴露出来，因此为了访问 UITableView 的某些属性，你必须访问位于 TableNode 底下的 UITableView 对象。</p>
<h3 id="设置-TableNote-的-Data-Source-amp-Delegate"><a href="#设置-TableNote-的-Data-Source-amp-Delegate" class="headerlink" title="设置 TableNote 的 Data Source &amp; Delegate"></a>设置 TableNote 的 Data Source &amp; Delegate</h3><p>和 UITableView 一样，ASTableNode 也有 Data Source 和 Delegate。TableNode 的 ASTableDataSource 和 ASTableDelegate 协议和 UITableViewDataSource 和 UITableViewDelegate 协议非常相似。</p>
<p>将 <code>wireDelegation</code>方法中的 tableView 修改为 tableNode</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)wireDelegation &#123;</div><div class="line">  <span class="keyword">self</span>.tableNode.dataSource = <span class="keyword">self</span>;</div><div class="line">  <span class="keyword">self</span>.tableNode.delegate = <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>并且让 controller 遵守 ASTableDataSource 和 ASTableDelegate 协议。</p>
<h4 id="实现-ASTableDataSource-协议"><a href="#实现-ASTableDataSource-协议" class="headerlink" title="实现 ASTableDataSource 协议"></a>实现 ASTableDataSource 协议</h4><p>首先，将 UITableViewDataSource 方法 <code>tableView:numberOfRowsInSection:</code> 修改为 ASTableDataSource 协议的版本。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSInteger</span>)tableNode:(ASTableNode *)tableNode numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.animals.count;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后，ASTableNodes 返回 cell 的方式和 UITableView 有所不同。将 <code>tableView:cellForRowAtIndexPath:</code>方法替换为:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1</span></div><div class="line">- (ASCellNodeBlock)tableNode:(ASTableView *)tableView nodeBlockForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">  <span class="comment">//2</span></div><div class="line">  RainforestCardInfo *animal = <span class="keyword">self</span>.animals[indexPath.row];</div><div class="line"></div><div class="line">  <span class="comment">//3</span></div><div class="line">  <span class="keyword">return</span> ^&#123;</div><div class="line">    <span class="comment">//4</span></div><div class="line">    CardNode *cardNode = [[CardNode alloc] initWithAnimal:animal];</div><div class="line"></div><div class="line">    <span class="comment">//You'll add something extra here later...</span></div><div class="line">    <span class="keyword">return</span> cardNode;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码解释：</p>
<ol>
<li>ASCellNode 等价于 UITableViewCell 或 UICollectionViewCell。注意这个方法返回的是一个 ASCellNodeBlock。因为一个 ASTableNode 在内部维护了所有的 cell，为每个 cell 的 Index Path 指定了一个 block，这样就能够并发的初始化所有的 cell。</li>
<li>得到一个数据模型对象。闭包会捕捉到这个对象。IndexPath 不需要在闭包中使用，有可能在闭包调用前数据会发生改变。</li>
<li>闭包中返回的类型必须是 ASCellNode。</li>
<li>不需要关心 cell 重用的问题，因此只需要实例化一个 cell。注意，你返回的是一个 CardNode 而不是 CardCell。</li>
</ol>
<h4 id="实现-ASTableDelegate-协议"><a href="#实现-ASTableDelegate-协议" class="headerlink" title="实现 ASTableDelegate 协议"></a>实现 ASTableDelegate 协议</h4><p>在使用 UITableView 的时候通常都需要实现 <code>tableView:heightForRowAtIndexPath:</code> 方法来计算每个 cell 的高度。</p>
<p>ASTableDelegate 中没有 <code>tableView:heightForRowAtIndexPath:</code> 方法。如果使用 ASDK, 所有的 ASCellNodes 都自己负责计算它们的大小。不需要提供一个固定的高度，你可以为每个 cell 指定一个最大尺寸和最小尺寸。这个例子中，你需要让每个 cell 至少占据屏幕 2/3 的高度。</p>
<p>将 -tableView:heightForRowAtIndexPath: 方法替换为:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-(ASSizeRange)tableNode:(ASTableNode *)tableNode constrainedSizeForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="built_in">CGFloat</span> width = [<span class="built_in">UIScreen</span> mainScreen].bounds.size.width;</div><div class="line">    <span class="built_in">CGSize</span> min = <span class="built_in">CGSizeMake</span>(width, ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.height/<span class="number">3</span>) * <span class="number">2</span>);</div><div class="line">    <span class="built_in">CGSize</span> max = <span class="built_in">CGSizeMake</span>(width, INFINITY);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> ASSizeRangeMake(min, max);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>搞定！ 运行一下，很流畅~</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-2/" itemprop="url">
                  AsyncDisplayKit 教程(2)：ASDisplayNode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-24T00:00:00+08:00">
                2017-02-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ASDisplayNode"><a href="#ASDisplayNode" class="headerlink" title="ASDisplayNode"></a>ASDisplayNode</h2><p>ASDisplayNode 是 ASDK 的核心类。</p>
<p>我们知道 UIView 是对 CALayer 的一个封装，添加了触摸事件的处理以及其他功能。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fd2tzeu6aej30i208mq3r.jpg" alt=""></p>
<p>ASDisplayNode 也使用了这种抽象。你可以认为 Node 包含了一个 View，就像 View 包含了一个 Layer。</p>
<p>Node 可以在后台队列中创建和配置，默认情况使用异步渲染。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fd2u1q81jbj30qo08ymx8.jpg" alt=""></p>
<p>Node 的 API 和 UIView 的难以置信的相似：所有的 View 属性都可以在 node 上找到相同的。你还可访问底层的 view 或 layer，就像你可以访问 UIView的 .layer 一样。</p>
<h2 id="Node-Containers"><a href="#Node-Containers" class="headerlink" title="Node Containers"></a>Node Containers</h2><p>Node 与四个容器类中的一个结合使用时，就产生魔法般的性能提升。</p>
<p>这四个类包含：</p>
<ul>
<li>ASViewController:  UIViewController 子类，允许你创建节点并进行管理。</li>
<li>ASCollectionNode 和 ASTableNode:  UICollectionView 和 UITableView 对应的 Node 类。</li>
<li>ASPagerNode:  ASCollectionNode 子类，和 UIPageViewController 相比，提供了很棒的 swiping 性能。</li>
</ul>
<p>真正的魔法来自于： ASRangeController，这 4 个类都会通过它来影响所包含的 node 的行为。这个后面再讲。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-1/" itemprop="url">
                  AsyncDisplayKit 教程(1)：介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-23T00:00:00+08:00">
                2017-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本系列翻译改编自 ray 的<a href="https://www.raywenderlich.com/124311/asyncdisplaykit-2-0-tutorial-getting-started" target="_blank" rel="external">《AsyncDisplayKit 2.0 Tutorial: Getting Started》</a>。</p>
<p>AsyncDisplayKit 是一个 UI 框架，源自 Facebook 的 Paper。它解决了 Paper 团队面临的一个核心问题：如何让主线程尽可能地保持简洁？ </p>
<p>用户界面完全依赖于主线程，并且对主线程的延迟非常敏感。主线程阻塞意味着掉帧，并导致用户体验很差。</p>
<p>主线程进行的高消耗操作包括：</p>
<ul>
<li>尺寸计算和视图布局：比如，<code>heightForRowAtIndexPath</code>方法，或者对 UILabel 调用 <code>sizeThatFits</code>方法。以及大量 AutoLayout 约束计算。</li>
<li>图片解码：在一个 UIImageView 中使用 UIImage，意味着首先要进行图片数据的解码。</li>
<li>文本渲染：复杂文本的渲染。</li>
<li>图形绘制：手动绘制渐变色和阴影。</li>
<li>对象生命周期：创建、操作和销毁系统对象（比如创建一个 UIView）。</li>
</ul>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fd32exi206j30rk0e6tbh.jpg" alt=""></p>
<p>AsyncDisplayKit 默认允许异步的进行尺寸计算，视图布局，Rendering（文本渲染、图形绘制、图片解码）操作。这样就大量的减轻了主线程的负担。</p>
<p>AsyncDisplayKit 支持 Objective-C 与 Swift，但是不支持 Interface Builder 与 AutoLayout。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/UIView-Animation-getting-start/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/UIView-Animation-getting-start/" itemprop="url">
                  UIView Animation 1：基础动画效果
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-22T00:00:00+08:00">
                2017-02-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS动画/" itemprop="url" rel="index">
                    <span itemprop="name">iOS动画</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>UIView Animation 是被设计来让开发者更简单的创建动画效果，避免使用复杂的 Core Animation。</p>
<p>本文将介绍 UIView Animation 的常用 API。</p>
<p>下图是一个普通的登录页面：</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fczhze1z9zj30ac0a1gm6.jpg" alt=""></p>
<h2 id="第一个动画"><a href="#第一个动画" class="headerlink" title="第一个动画"></a>第一个动画</h2><p>第一个动画效果是当用户打开 app 时，页面的 UI 元素从屏幕外移动到屏幕内。</p>
<p>在<code>viewWillAppear</code>中,将这几个元素移出屏幕：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">heading.center.x  -= view.bounds.width</div><div class="line">username.center.x -= view.bounds.width</div><div class="line">password.center.x -= view.bounds.width</div></pre></td></tr></table></figure>
<p>目前这几个元素的位置相当于在当前屏幕左侧新建了一个对称屏幕中的位置。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fczilnuiebj30ac0baq3c.jpg" alt=""></p>
<p>现在可以在页面显示后，将这几个元素移动回原位置，为了避免所有元素同步显示显得呆板，可以设置显示的先后顺序。在<code>viewDidAppear</code>中：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>) &#123;</div><div class="line">    <span class="keyword">self</span>.heading.center.x += <span class="keyword">self</span>.view.bounds.width</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.3</span>, options: [], animations: &#123; </div><div class="line">    <span class="keyword">self</span>.username.center.x += <span class="keyword">self</span>.view.bounds.width</div><div class="line">&#125;, completion: <span class="literal">nil</span>)</div><div class="line">    </div><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.4</span>, options: [], animations: &#123; </div><div class="line">    <span class="keyword">self</span>.password.center.x += <span class="keyword">self</span>.view.bounds.width</div><div class="line">&#125;, completion: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p><code>option</code> 是一组自定义的选项，这里先传入<code>[]</code>，表示没有特殊选项。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fczj8hdmz6g30a309cwfb.gif" alt=""></p>
<h2 id="可以添加动画的属性"><a href="#可以添加动画的属性" class="headerlink" title="可以添加动画的属性"></a>可以添加动画的属性</h2><p>不是所有的 UIView 属性都可以添加动画，以下是可以使用动画的属性。</p>
<h3 id="位置和大小"><a href="#位置和大小" class="headerlink" title="位置和大小"></a>位置和大小</h3><p>对视图位置和大小的修改可以产生扩张，收缩，移动效果。以下是相关的属性：</p>
<ul>
<li>bounds：在视图的 frame 中重新安排视图的内容的位置</li>
<li>frame：移动或缩放视图</li>
<li>center：移动视图到新位置</li>
</ul>
<p>你可以修改这些属性或者这些属性的成员。比如通过 <code>center.y</code> 改变竖直位置，通过<code>frame.size.width</code>来缩放。</p>
<h3 id="外观"><a href="#外观" class="headerlink" title="外观"></a>外观</h3><p>可以改变视图的背景色或透明度。</p>
<ul>
<li>backgroundColor</li>
<li>alpha：可以制造淡入淡出的效果。</li>
</ul>
<p>对云朵使用淡入动画:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.5</span>, options: [], animations: &#123;</div><div class="line">    <span class="keyword">self</span>.cloud1.alpha = <span class="number">1.0</span></div><div class="line">&#125;, completion: <span class="literal">nil</span>)</div><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.7</span>, options: [], animations: &#123;</div><div class="line">    <span class="keyword">self</span>.cloud2.alpha = <span class="number">1.0</span></div><div class="line">&#125;, completion: <span class="literal">nil</span>)</div><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.9</span>, options: [], animations: &#123;</div><div class="line">    <span class="keyword">self</span>.cloud3.alpha = <span class="number">1.0</span></div><div class="line">&#125;, completion: <span class="literal">nil</span>)</div><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">1.0</span>, options: [], animations: &#123;</div><div class="line">    <span class="keyword">self</span>.cloud4.alpha = <span class="number">1.0</span></div><div class="line">&#125;, completion: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fczm9miadhg30a30dkdhq.gif" alt=""></p>
<h3 id="变形"><a href="#变形" class="headerlink" title="变形"></a>变形</h3><ul>
<li>transform： 旋转，缩放</li>
</ul>
<p>底层是仿射变换。可以使用跟强大的缩放因子和旋转角度，而不是详细的 bounds 和  center。</p>
<h2 id="动画选项"><a href="#动画选项" class="headerlink" title="动画选项"></a>动画选项</h2><p>接下来我们了解之前提到的 <code>option</code>。<code>UIViewAnimationOptions</code>罗列了所有的<code>option</code>，可以通过组合不同的<code>option</code>。</p>
<h3 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h3><ul>
<li>.repeat 包含这个选项可以使动画永远重复</li>
<li>.autoreverse 这个选项只能和 <code>.repeat</code>组合起来用。让你的动画先正向播放，再逆向播放。</li>
</ul>
<p>修改代码:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.4</span>,</div><div class="line">               options: .<span class="keyword">repeat</span>,</div><div class="line">               animations: &#123;</div><div class="line">                <span class="keyword">self</span>.password.center.x += <span class="keyword">self</span>.view.bounds.width</div><div class="line">                &#125;,</div><div class="line">               completion: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1fczllm4fjqg30a309cta9.gif" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="type">UIView</span>.animate(withDuration: <span class="number">0.5</span>, delay: <span class="number">0.4</span>,</div><div class="line">               options: [.<span class="keyword">repeat</span>,.autoreverse] ,</div><div class="line">               animations: &#123;</div><div class="line">                <span class="keyword">self</span>.password.center.x += <span class="keyword">self</span>.view.bounds.width</div><div class="line">                &#125;,</div><div class="line">               completion: <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fczllqhd5ng30a309cmyw.gif" alt=""></p>
<p>注意 swift 为了方便使用，在只有一个 <code>option</code> 时 允许不将其放在 <code>[]</code> 中。</p>
<h3 id="动画缓动（Animation-easing）"><a href="#动画缓动（Animation-easing）" class="headerlink" title="动画缓动（Animation easing）"></a>动画缓动（Animation easing）</h3><p>物理世界的运动不一直是匀速的，不仅速度是变动的，而且加速度也是变动的。<br>常用的 easing option：</p>
<ul>
<li>.curveLinear： 用于没有加速度的动画。</li>
<li>.curveEaseIn： 用于开始时加速。</li>
<li>.curveEaseOut： 用于结束时减速。</li>
<li>.curveEaseInOut： 用于开始时加速，结束时减速。</li>
</ul>
<hr>
<div style="text-align: center"><br>关注公众号（ID：SwiftBetter），进一步探讨主题<br><br><br>每日精选高清题图，可做壁纸<br></div><br><div style="text-align: center"><br><img src="https://vernsu.github.io/images/wxqrcode.jpg" style="text-align: center;display: block;margin:auto;"><br></div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/swift-enum-associated-values/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/swift-enum-associated-values/" itemprop="url">
                  Swift 中枚举的关联值
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-21T00:00:00+08:00">
                2017-02-21
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="枚举关联值与值绑定模式"><a href="#枚举关联值与值绑定模式" class="headerlink" title="枚举关联值与值绑定模式"></a>枚举关联值与值绑定模式</h2><p>当枚举的关联值和值绑定模式结合起来，就能够达到从枚举中取得关联值的效果。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Organism</span> </span>&#123;</div><div class="line">  <span class="keyword">case</span> plant</div><div class="line">  <span class="keyword">case</span> animal(legs: <span class="type">Int</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> pet = <span class="type">Organism</span>.animal(legs: <span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="keyword">switch</span> pet &#123;</div><div class="line"><span class="keyword">case</span> .animal(<span class="keyword">let</span> legs):</div><div class="line">  <span class="built_in">print</span>(<span class="string">" <span class="subst">\(legs)</span> 条腿的动物"</span>) <span class="comment">// Printed: 4 条腿的动物</span></div><div class="line"><span class="keyword">default</span>:</div><div class="line">  <span class="built_in">print</span>(<span class="string">"植物"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码中，.animal 的关联值是一个叫 legs 的常量。怎么把关联的值取出来？使用值绑定模式即可取出值。定义一个局部变量，名字可以随便取(不一定是 legs)，这个局部变量会和关联值连接起来。</p>
<h2 id="optional"><a href="#optional" class="headerlink" title="optional"></a>optional</h2><p>optional 就是用 enum 实现的。</p>
<ol>
<li>.none 意味着没有值</li>
<li>.some 意味着有值，即有一个关联值</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> age: <span class="type">Int</span>?</div><div class="line">age = <span class="number">17</span></div><div class="line"><span class="comment">//age = nil</span></div><div class="line"></div><div class="line"><span class="keyword">switch</span> age &#123;</div><div class="line"><span class="keyword">case</span> .<span class="keyword">none</span>:</div><div class="line">  <span class="built_in">print</span>(<span class="string">"No value"</span>)</div><div class="line"><span class="keyword">case</span> .some(<span class="keyword">let</span> value):</div><div class="line">  <span class="built_in">print</span>(<span class="string">"Got a value: <span class="subst">\(value)</span>"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>swift 中 nil 中其实就是 .none。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> optionalNil: <span class="type">Int</span>? = .<span class="keyword">none</span></div><div class="line"></div><div class="line">optionalNil == <span class="literal">nil</span>    <span class="comment">// true</span></div><div class="line">optionalNil == .<span class="keyword">none</span>  <span class="comment">// true</span></div></pre></td></tr></table></figure>
<hr>
<div style="text-align: center"><br>关注公众号（ID：SwiftBetter），进一步探讨主题<br><br><br>每日精选高清题图，可做壁纸<br></div><br><div style="text-align: center"><br><img src="https://vernsu.github.io/images/wxqrcode.jpg" style="text-align: center;display: block;margin:auto;"><br></div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/swift-pattern-matching-value-binding-pattern-identifier-pattern/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/swift-pattern-matching-value-binding-pattern-identifier-pattern/" itemprop="url">
                  Swift 模式匹配之标识符模式与值绑定模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-20T00:00:00+08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="值绑定模式（Value-Binding-Pattern）"><a href="#值绑定模式（Value-Binding-Pattern）" class="headerlink" title="值绑定模式（Value-Binding Pattern）"></a>值绑定模式（Value-Binding Pattern）</h2><p>值绑定模式是指把匹配到的值绑定给一个变量或常量。你能够在接下来的代码块中使用该变量/常量的值。把匹配到的值绑定给变量时，用关键字 var，绑定给常量时，用关键字 let。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">let coordinate = (x: 1, y: 0, z: 0)</div><div class="line"></div><div class="line">if case (let x, 0, 0) = coordinate &#123;</div><div class="line">  print(“x坐标为 \(x)") //  1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个 case 匹配 x 坐标为任意值，y，z为0。然后名为 x 的常量绑定了元组 x 部分的值。相当于你告诉编译器，从(something，0，0)中找到一个值时，分配something给x。</p>
<p>如果要绑定多个值，声明多个就好了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if case let (x, y, 0) = coordinate &#123;</div><div class="line">  print(“x,y分别是(\(x), \(y))&quot;) //  1, 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将let移到元组外边，编译器能够绑定所有的常量。这个例子中，let 会分配到元组模式 (x, y, z) 中的各个标识符模式。因此，switch 语句中 case let (x, y ,0): 和 case (let x, let y, 0): 的匹配效果是一样的。</p>
<h2 id="标识符模式-（Identifier-Pattern）"><a href="#标识符模式-（Identifier-Pattern）" class="headerlink" title="标识符模式 （Identifier Pattern）"></a>标识符模式 （Identifier Pattern）</h2><p>标识符模式是值绑定模式的子模式。标识符模式是常量或者变量的名称自身。例如，在下面的常量声明中，someValue 是一个标识符模式，匹配了 Int 类型的 42：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> someValue = <span class="number">42</span></div></pre></td></tr></table></figure>
<p>当匹配成功时，42 被绑定（赋值）给常量 someValue。</p>
<h2 id="在值绑定模式中的标识符模式会把新命名的变量或常量与匹配到的值做绑定。例如，你可以拆开一个元组，然后把每个元素绑定到相应的标识符模式中。"><a href="#在值绑定模式中的标识符模式会把新命名的变量或常量与匹配到的值做绑定。例如，你可以拆开一个元组，然后把每个元素绑定到相应的标识符模式中。" class="headerlink" title="在值绑定模式中的标识符模式会把新命名的变量或常量与匹配到的值做绑定。例如，你可以拆开一个元组，然后把每个元素绑定到相应的标识符模式中。"></a>在值绑定模式中的标识符模式会把新命名的变量或常量与匹配到的值做绑定。例如，你可以拆开一个元组，然后把每个元素绑定到相应的标识符模式中。</h2><div style="text-align: center"><br>关注公众号（ID：SwiftBetter），进一步探讨主题<br><br><br>每日精选高清题图，可做壁纸<br></div><br><div style="text-align: center"><br><img src="https://vernsu.github.io/images/wxqrcode.jpg" style="text-align: center;display: block;margin:auto;"><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/iOS-cornerRadius-masksToBounds-CALayer/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/iOS-cornerRadius-masksToBounds-CALayer/" itemprop="url">
                  iOS 中 masksToBounds 与 layer’s contents
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-19T00:00:00+08:00">
                2017-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="masksToBounds"><a href="#masksToBounds" class="headerlink" title="masksToBounds"></a>masksToBounds</h3><p>在<a href="http://swift.diagon.me/cornerRadius/">《iOS 性能优化之视图圆角》</a>中提到同时使用 <code>cornerRadius</code> 和 <code>maskToBounds</code> 会触发离屏渲染。</p>
<p>如果你给 UIImageView 设置圆角，会发现只需要设置 <code>cornerRadius</code>，就可以完成圆角效果，那 <code>masksToBounds</code> 是做什么的？</p>
<p>查看 <code>cornerRadius</code> 的文档：</p>
<blockquote>
<p>Setting the radius to a value greater than 0.0 causes the layer to begin drawing rounded corners on its background. By default, the corner radius does not apply to the image in the layer’s contents property; it applies only to the background color and border of the layer. However, setting the masksToBounds property to YES causes the content to be clipped to the rounded corners.</p>
</blockquote>
<p>说明 <code>cornerRadius</code> 设置的圆角只对背景色和图层边框有用，对 <code>layer</code> 的 <code>contents</code> 属性中的 <code>image</code> 无效。当 <code>contents</code> 有内容或者内容背景不是透明的时，单靠 <code>cornerRadius</code> 是无法完成圆角效果的（比如说 UILabel ）。所以才要设置 <code>masksToBounds</code> 为 <code>true</code> (在 UIView 上对应的属性是 <code>clipsToBounds</code>，在 IB 里对应的设置是「Clip Subiews」选项)。<code>masksToBounds</code> 会裁剪 <code>layer</code>的 <code>contents</code>。</p>
<h3 id="layer’s-contents"><a href="#layer’s-contents" class="headerlink" title="layer’s contents"></a>layer’s contents</h3><p>CALayer 有一个 <code>contents</code> 属性，这个属性的类型被定义为 id，意味着它可以是任何类型的对象。但是，在实践中，如果 <code>contents</code> 不是 CGImage，那么图层将是空白。</p>
<p>UIImage 有一个 cgImage 属性，我们把 layerView 图层的 contents 属性设置成图片。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">layerView.layer.contents = <span class="type">UIImage</span>(named: <span class="string">"image"</span>)?.cgImage</div></pre></td></tr></table></figure>
<p>我们利用 CALayer 在一个普通的 UIView 中显示了一张图片。</p>
<hr>
<div style="text-align: center"><br>关注公众号（ID：SwiftBetter），进一步探讨主题<br><br><br>每日精选高清题图，可做壁纸<br></div><br><div style="text-align: center"><br><img src="https://vernsu.github.io/images/wxqrcode.jpg" style="text-align: center;display: block;margin:auto;"><br></div>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="万恶胖为首" />
          <p class="site-author-name" itemprop="name">万恶胖为首</p>
          <p class="site-description motion-element" itemprop="description">笨办法学Swift</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/rss.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">万恶胖为首</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
  

  

  

  

  


</body>
</html>
