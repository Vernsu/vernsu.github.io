<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/rss.xml" title="Swift学徒" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="笨办法学Swift">
<meta property="og:type" content="website">
<meta property="og:title" content="Swift学徒">
<meta property="og:url" content="http://swift.diagon.me/index.html">
<meta property="og:site_name" content="Swift学徒">
<meta property="og:description" content="笨办法学Swift">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift学徒">
<meta name="twitter:description" content="笨办法学Swift">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://swift.diagon.me/"/>





  <title> Swift学徒 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2d1b9ca1ddd64ef2206b43ea10ec9d25";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Swift学徒</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">笨办法学Swift</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/iOS-CommonLibs-Swift/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/iOS-CommonLibs-Swift/" itemprop="url">
                  iOS 开发常用第三方库 [Swift 版]
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-18T00:00:00+08:00">
                2017-03-18
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href=""></a></p>
<ul>
<li>网络<ul>
<li><a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="external">Alamofire</a> 强大的网络基础库</li>
<li><a href="https://github.com/shadowsocks/ShadowsocksX-NG" target="_blank" rel="external">ShadowsocksX-NG</a> 新一代的 ShadowsocksX</li>
<li><a href="https://github.com/Moya/Moya" target="_blank" rel="external">Moya</a> 基于 Alamofire 的网络抽象层</li>
<li><a href="https://github.com/ashleymills/Reachability.swift" target="_blank" rel="external">Reachability.swift</a> 检测网络可用性</li>
<li><a href="https://github.com/lexrus/VPNOn" target="_blank" rel="external">VPNOn</a> VPN</li>
<li><a href="https://github.com/daltoniam/Starscream" target="_blank" rel="external">Starscream</a> Websockets</li>
</ul>
</li>
</ul>
<ul>
<li><p>JSON</p>
<ul>
<li><a href="https://github.com/SwiftyJSON/SwiftyJSON" target="_blank" rel="external">SwiftyJSON</a> 处理 JSON 数据</li>
<li><a href="https://github.com/Hearst-DD/ObjectMapper" target="_blank" rel="external">ObjectMappe</a> 处理 JSON 数据</li>
<li><a href="https://github.com/thoughtbot/Argo" target="_blank" rel="external">Argo</a> 处理 JSON 数据</li>
<li><a href="https://github.com/Ahmed-Ali/JSONExport" target="_blank" rel="external">JSONExport</a> 输出 JSON 转换代码的工具</li>
</ul>
</li>
<li><p>布局</p>
<ul>
<li><a href="https://github.com/SnapKit/SnapKit" target="_blank" rel="external">SnapKit</a> Autolayout 库</li>
<li><a href="https://github.com/robb/Cartography" target="_blank" rel="external">Cartography</a> Autolayout 库</li>
<li><a href="https://github.com/mamaral/Neon" target="_blank" rel="external">Neon</a> 强大的布局框架</li>
</ul>
</li>
</ul>
<ul>
<li><p>图片</p>
<ul>
<li><a href="https://github.com/BradLarson/GPUImage2" target="_blank" rel="external">GPUImage2</a> 基于 GPU 处理图片与视频    </li>
<li><a href="https://github.com/onevcat/Kingfisher" target="_blank" rel="external">Kingfisher</a>  异步图片缓存库</li>
<li><a href="https://github.com/Alamofire/AlamofireImage" target="_blank" rel="external">AlamofireImage</a> AlamofireImage</li>
<li><a href="https://github.com/kean/Nuke" target="_blank" rel="external">Nuke</a> 图片加载和缓存</li>
</ul>
</li>
<li><p>服务端</p>
<ul>
<li><a href="https://github.com/PerfectlySoft/Perfect" target="_blank" rel="external">Perfect</a> </li>
<li><a href="https://github.com/vapor/vapor" target="_blank" rel="external">vapor</a></li>
<li><a href="https://github.com/IBM-Swift/Kitura" target="_blank" rel="external">Kitura</a>    </li>
</ul>
</li>
<li><p>编程方式</p>
<ul>
<li><a href="https://github.com/mxcl/PromiseKit" target="_blank" rel="external">PromiseKit</a> 轻量级异步编程库</li>
<li><a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">ReactiveCocoa</a> ReactiveCocoa</li>
<li><a href="https://github.com/ReactiveX/RxSwift" target="_blank" rel="external">RxSwift</a> RxSwift</li>
<li><a href="https://github.com/duemunk/Async" target="_blank" rel="external">Async</a> GCD 异步编程语法糖</li>
<li><a href="https://github.com/ankurp/Dollar" target="_blank" rel="external">Dollar</a>为 Swift 编程语言提供函数式编程的助手方法</li>
<li><a href="https://github.com/ReactiveKit/Bond" target="_blank" rel="external">Bond</a> 绑定库</li>
<li><a href="https://github.com/typelift/Swiftz" target="_blank" rel="external">Swiftz</a> 函数式编程</li>
</ul>
</li>
<li><p>学习资源</p>
<ul>
<li><a href="https://github.com/raywenderlich/swift-algorithm-club" target="_blank" rel="external">swift-algorithm-club</a> 算法和数据结构</li>
<li><a href="https://github.com/vsouza/awesome-ios" target="_blank" rel="external">awesome-ios</a>awesome-ios</li>
<li><a href="https://github.com/dkhamsing/open-source-ios-apps" target="_blank" rel="external">open-source-ios-apps</a> 收集 iOS 开源项目</li>
<li><a href="https://github.com/ipader/SwiftGuide" target="_blank" rel="external">SwiftGuide</a> Swift 学习资源</li>
<li><a href="https://github.com/matteocrippa/awesome-swift" target="_blank" rel="external">awesome-swift</a> awesome-swift</li>
<li><a href="https://github.com/allenwong/30DaysofSwift" target="_blank" rel="external">30DaysofSwift</a> 30DaysofSwift</li>
<li><a href="https://github.com/soapyigu/Swift30Projects" target="_blank" rel="external">Swift30Projects</a> Swift30Projects</li>
<li><a href="https://github.com/ochococo/Design-Patterns-In-Swift" target="_blank" rel="external">Design-Patterns-In-Swift</a> Swift 实现设计模式</li>
<li><a href="https://github.com/collinhundley/Swift-AI" target="_blank" rel="external">Swift-AI</a> 机器学习</li>
<li><a href="https://github.com/larrynatalicio/15DaysofAnimationsinSwift" target="_blank" rel="external">15DaysofAnimationsinSwift</a> 学习动画教程</li>
</ul>
</li>
<li><p>性能</p>
<ul>
<li><a href="https://github.com/zixun/GodEye" target="_blank" rel="external">GodEye</a> 自动显示 Log,Crash,Network,ANR,Leak,CPU,RAM,FPS,NetFlow等信息</li>
<li><a href="https://github.com/realm/SwiftLint" target="_blank" rel="external">SwiftLint</a> SwiftLint</li>
<li><a href="https://github.com/Quick/Quick" target="_blank" rel="external">Quick</a> 一个测试框架</li>
<li><a href="https://github.com/mattt/Surge" target="_blank" rel="external">Surge</a>基于苹果 Accelerate 高性能计算框架封装库</li>
</ul>
</li>
<li><p>数据</p>
<ul>
<li><a href="https://github.com/stephencelis/SQLite.swift" target="_blank" rel="external">SQLite.swift</a> SQLite.swift</li>
<li><a href="https://github.com/krzyzanowskim/CryptoSwift" target="_blank" rel="external">CryptoSwift</a>CryptoSwift 是一个用 Swift 写的加密工具包，支持多种加密算法，如MD5、SHA1、AES-128等</li>
<li><a href="https://github.com/Haneke/HanekeSwift" target="_blank" rel="external">HanekeSwift</a> 轻量级的缓存库</li>
<li><a href="https://github.com/SwiftGen/SwiftGen" target="_blank" rel="external">SwiftGen</a>快速生成ios资源，如国际化、图片等</li>
<li><a href="https://github.com/mac-cain13/R.swift" target="_blank" rel="external">R.swift</a> 安全的获取文件资源</li>
<li><a href="https://github.com/radex/SwiftyUserDefaults" target="_blank" rel="external">SwiftyUserDefaults</a> NSUserDefaults</li>
<li><a href="https://github.com/delba/Permission" target="_blank" rel="external">Permission</a> 各种系统权限</li>
</ul>
</li>
<li>架构<ul>
<li><a href="https://github.com/Carthage/Carthage" target="_blank" rel="external">Carthage</a> 包依赖管理</li>
<li><a href="https://github.com/apple/swift-package-manager" target="_blank" rel="external">swift-package-manager</a> Swift 包管理工具</li>
<li><a href="https://github.com/ReSwift/ReSwift" target="_blank" rel="external">ReSwift</a> 单项的数据流</li>
<li><a href="https://github.com/pNre/ExSwift" target="_blank" rel="external">ExSwift</a> Swift 类型扩展</li>
<li><a href="https://github.com/SwiftCarlos/Swift" target="_blank" rel="external">Reusable Swift</a> 可重用的代码</li>
<li><a href="https://github.com/SwifterSwift/SwifterSwift" target="_blank" rel="external">SwifterSwift</a> 提高生产力的类型扩展</li>
</ul>
</li>
</ul>
<ul>
<li><p>开源项目</p>
<ul>
<li><a href="https://github.com/kickstarter/ios-oss" target="_blank" rel="external">kickstarter</a> 一个众筹平台</li>
<li><a href="https://github.com/CatchChat/Yep" target="_blank" rel="external">Yep</a> 遇见天才</li>
</ul>
</li>
<li><p>UI控件</p>
<ul>
<li>图表<ul>
<li><a href="https://github.com/danielgindi/Charts" target="_blank" rel="external">Charts</a> 柱状图，饼状图等</li>
<li><a href="https://github.com/philackm/Scrollable-GraphView" target="_blank" rel="external">Scrollable-GraphView</a> 可以滚动的曲线图</li>
</ul>
</li>
<li>TableView<ul>
<li><a href="https://github.com/marty-suzuki/ReverseExtension" target="_blank" rel="external">ReverseExtension</a> 颠倒的 TableView</li>
<li><a href="https://github.com/jerkoch/SwipeCellKit" target="_blank" rel="external">SwipeCellKit</a> 可滑动操作的 TableViewCell</li>
<li><a href="https://github.com/xmartlabs/Eureka" target="_blank" rel="external">Eureka</a> Eureka可以帮你简单优雅的实现动态table-view表单。</li>
</ul>
</li>
<li>Cell<ul>
<li><a href="https://github.com/Ramotion/folding-cell" target="_blank" rel="external">folding-cell</a> 可扩展收缩的 Cell</li>
</ul>
</li>
<li>导航栏<ul>
<li><a href="https://github.com/andreamazz/AMScrollingNavbar" target="_blank" rel="external">AMScrollingNavbar</a> 能够跟随 UIScrollView 滚动的 UINavigationBar    </li>
</ul>
</li>
<li>TabBar<ul>
<li><a href="https://github.com/Ramotion/animated-tab-bar" target="_blank" rel="external">animated-tab-bar</a> animated-tab-bar</li>
</ul>
</li>
<li>提示<ul>
<li><a href="https://github.com/nickoneill/PermissionScope" target="_blank" rel="external">PermissionScope</a> 智能的 iOS 权限 提醒</li>
<li><a href="https://github.com/vikmeup/SCLAlertView-Swift" target="_blank" rel="external">SCLAlertView-Swift</a> 丰富的弹窗效果</li>
</ul>
</li>
<li>分段<ul>
<li><a href="https://github.com/uacaps/PageMenu" target="_blank" rel="external">PageMenu</a> 分段控制器</li>
<li><a href="https://github.com/xmartlabs/XLPagerTabStrip" target="_blank" rel="external">XLPagerTabStrip</a> 安卓风格的分段控制器</li>
</ul>
</li>
<li>TextField<ul>
<li><a href="https://github.com/raulriera/TextFieldEffects" target="_blank" rel="external">TextFieldEffects</a> 感应式的 TextField</li>
</ul>
</li>
<li>Collection<ul>
<li><a href="https://github.com/Ramotion/expanding-collection" target="_blank" rel="external">expanding-collection</a> a card peek/pop controller </li>
</ul>
</li>
</ul>
</li>
<li><p>动画</p>
<ul>
<li><a href="https://github.com/lkzhao/Hero" target="_blank" rel="external">Hero</a>优雅的过渡效果</li>
<li><a href="https://github.com/MengTo/Spring" target="_blank" rel="external">Spring</a> 动画库</li>
<li><a href="https://github.com/storehouse/Advance" target="_blank" rel="external">Advance</a> 动画框架</li>
<li><a href="https://github.com/CosmicMind/Material" target="_blank" rel="external">Material</a> 一个扁平化设计的动画库</li>
<li><a href="https://github.com/lexrus/LTMorphingLabel" target="_blank" rel="external">LTMorphingLabel</a> UILabel 的变形动画效果</li>
<li><a href="https://github.com/IBAnimatable/IBAnimatable" target="_blank" rel="external">IBAnimatable</a> Interface Builder with IBAnimatable</li>
<li><a href="https://github.com/ninjaprox/NVActivityIndicatorView" target="_blank" rel="external">NVActivityIndicatorView</a> Loading 动画</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/Pattern-MVVM/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/Pattern-MVVM/" itemprop="url">
                  iOS 架构模式之 MVVM
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-04T00:00:00+08:00">
                2017-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="MVVM-构成"><a href="#MVVM-构成" class="headerlink" title="MVVM 构成"></a>MVVM 构成</h3><p>MVVM 看上去和 MVP 很像：</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNbRwly1fd8t675iqaj314g0ek768.jpg" alt=""></p>
<p>显然，MVVM 也将 ViewController 视为 View。之前我们说了 MVC 中的 Controller 里有大量表示逻辑，ViewModel 就是承载这些表示逻辑的东西。</p>
<p>MVVM 的 ViewModel 和 MVP的 Presenter 相比，多了数据绑定机制。一旦 ViewModel 所对应的 Model 发生变化，ViewModel 的属性也会发生变化，而相对应的 View 也随即产生变化。绑定机制既有很明显的强大优点——自动连接 View 和 Model，也有很明显的缺点——更高的耦合度，更复杂的代码逻辑。</p>
<h3 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h3><p>实现绑定一般有两种方式：</p>
<ul>
<li>基于KVO的绑定：比如 <a href="https://github.com/Raizlabs/RZDataBinding" target="_blank" rel="external">RZDataBinding</a> 和 <a href="https://github.com/SwiftBond/Bond" target="_blank" rel="external">SwiftBond</a></li>
<li><a href="https://gist.github.com/JaviLorbada/4a7bd6129275ebefd5a6" target="_blank" rel="external">函数响应式编程</a>：比如像 <a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">ReactiveCocoa</a>、<a href="https://github.com/ReactiveX/RxSwift/" target="_blank" rel="external">RxSwift</a> 或者 <a href="https://github.com/mxcl/PromiseKit" target="_blank" rel="external">PromiseKit</a></li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>FRF 框架 和 KVO过度复杂，我们使用 showGreeting 方法 和 greetingDidChange 回调方法来达成这个目的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">import</span> UIKit</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123; <span class="comment">// Model</span></div><div class="line">    <span class="keyword">let</span> firstName: <span class="type">String</span></div><div class="line">    <span class="keyword">let</span> lastName: <span class="type">String</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">GreetingViewModelProtocol</span>: <span class="title">class</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> greeting: <span class="type">String</span>? &#123; <span class="keyword">get</span> &#125;</div><div class="line">    <span class="keyword">var</span> greetingDidChange: ((<span class="type">GreetingViewModelProtocol</span>) -&gt; ())? &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125; <span class="comment">// function to call when greeting did change</span></div><div class="line">    <span class="keyword">init</span>(person: <span class="type">Person</span>)</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showGreeting</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingViewModel</span> : <span class="title">GreetingViewModelProtocol</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> person: <span class="type">Person</span></div><div class="line">    <span class="keyword">var</span> greeting: <span class="type">String</span>? &#123;</div><div class="line">        <span class="keyword">didSet</span> &#123;</div><div class="line">            <span class="keyword">self</span>.greetingDidChange?(<span class="keyword">self</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> greetingDidChange: ((<span class="type">GreetingViewModelProtocol</span>) -&gt; ())?</div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(person: <span class="type">Person</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.person = person</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showGreeting</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.greeting = <span class="string">"Hello"</span> + <span class="string">" "</span> + <span class="keyword">self</span>.person.firstName + <span class="string">" "</span> + <span class="keyword">self</span>.person.lastName</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingViewController</span> : <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> viewModel: <span class="type">GreetingViewModelProtocol</span>! &#123;</div><div class="line">        <span class="keyword">didSet</span> &#123;</div><div class="line">            <span class="keyword">self</span>.viewModel.greetingDidChange = &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span>] viewModel <span class="keyword">in</span></div><div class="line">                <span class="keyword">self</span>.greetingLabel.text = viewModel.greeting</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">let</span> showGreetingButton = <span class="type">UIButton</span>()</div><div class="line">    <span class="keyword">let</span> greetingLabel = <span class="type">UILabel</span>()</div><div class="line"> </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="keyword">self</span>.showGreetingButton.addTarget(<span class="keyword">self</span>.viewModel, action: <span class="string">"showGreeting"</span>, forControlEvents: .<span class="type">TouchUpInside</span>)</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 布局代码</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// MVVM</span></div><div class="line"><span class="keyword">let</span> model = <span class="type">Person</span>(firstName: <span class="string">"David"</span>, lastName: <span class="string">"Blaine"</span>)</div><div class="line"><span class="keyword">let</span> viewModel = <span class="type">GreetingViewModel</span>(person: model)</div><div class="line"><span class="keyword">let</span> view = <span class="type">GreetingViewController</span>()</div><div class="line">view.viewModel = viewModel</div></pre></td></tr></table></figure>
<p>抛开绑定机制不说，ViewModel 做的就是表示逻辑的载体，最简单的实现就是在 ViewController 中调用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.greetingLabel.text = <span class="keyword">self</span>.viewModel.greeting</div></pre></td></tr></table></figure>
<p>我们评估下之前提出的架构特点：</p>
<ol>
<li>职能均分：分隔的很清楚。事实上，MVVM的View要比MVP中的View承担的责任多。因为前者通过ViewModel的设置绑定来更新状态，而后者只监听Presenter的事件但并不会对自己有什么更新。</li>
<li>容易测试：确实易于测试。如果我们没有将表示逻辑移入 ViewModel，我们将不得不实例化一个完整的 ViewController 以及伴随的 View，然后去比较我们 View 中的数值。但另一方面，数据绑定机制使得 定位 bug 变得更难了。数据绑定使程序异常能快速的传递到其他位置，在 View 上发现的 bug 有可能是由 ViewModel 造成的，也有可能是由 Model 造成的，传递链越长，对 Bug 的定位就越困难。</li>
<li>易用，维护成本低：在我们例子中的代码量和 MVP 的差不多，但是在实际开发中，使用了诸如 ReativeCocoa 这样的第三方库 ，MVVM 代码量将会小的多。 </li>
</ol>
<h3 id="架构模式选择"><a href="#架构模式选择" class="headerlink" title="架构模式选择"></a>架构模式选择</h3><p>没有完美的架构模式，只有适用于你的 App 业务场景和团队的架构模式。比如数据逻辑简单、注重视觉展示的页面，原始的 MVC 可能是最优解。而 MVP 的特点是有更好的灵活性和扩展性。MVVM 可以兼容当前使用 MVC架构模式 。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/Pattern-MVP/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/Pattern-MVP/" itemprop="url">
                  iOS 架构模式之 MVP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-03T00:00:00+08:00">
                2017-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="MVP-构成"><a href="#MVP-构成" class="headerlink" title="MVP 构成"></a>MVP 构成</h3><p>在了解 MVC 之后，我们再来看看 MVP：</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNbRwgy1fd8qn6wrh4j30m806s3zh.jpg" alt=""></p>
<p>我们知道实际上 MVC 中的 View 和 Controller 是紧密耦合的。MVP 中的中间者 Presenter 与  View Controller 的生命周期、页面布局没有任何关系，它负责更新 View 的数据与状态。</p>
<p>Presenter 可以只针对特定模块的 View，MVC 中的 Controller 一般会管理一个或多个 Model 和一个或多个 View，而 Presenter 则是 M-P-V 一对一，有更细的粒度和更好的解耦。</p>
<h3 id="UIViewController-是-View"><a href="#UIViewController-是-View" class="headerlink" title="UIViewController 是 View"></a>UIViewController 是 View</h3><p>在 MVP 中，UIViewController 的子类实际上是 View 而不是 Presenter。这个定义让结构更加清晰，代价是开发速度的降低。因为必须手动进行数据和事件绑定。</p>
<h3 id="MVP-实例"><a href="#MVP-实例" class="headerlink" title="MVP 实例"></a>MVP 实例</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123; <span class="comment">// Model</span></div><div class="line">    <span class="keyword">let</span> firstName: <span class="type">String</span></div><div class="line">    <span class="keyword">let</span> lastName: <span class="type">String</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">GreetingView</span>: <span class="title">class</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setGreeting</span><span class="params">(greeting: String)</span></span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">GreetingViewPresenter</span> </span>&#123;</div><div class="line">    <span class="keyword">init</span>(view: <span class="type">GreetingView</span>, person: <span class="type">Person</span>)</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showGreeting</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingPresenter</span> : <span class="title">GreetingViewPresenter</span> </span>&#123;</div><div class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> view: <span class="type">GreetingView</span></div><div class="line">    <span class="keyword">let</span> person: <span class="type">Person</span></div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(view: <span class="type">GreetingView</span>, person: <span class="type">Person</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.view = view</div><div class="line">        <span class="keyword">self</span>.person = person</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showGreeting</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> greeting = <span class="string">"Hello"</span> + <span class="string">" "</span> + <span class="keyword">self</span>.person.firstName + <span class="string">" "</span> + <span class="keyword">self</span>.person.lastName</div><div class="line">        <span class="keyword">self</span>.view.setGreeting(greeting)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingViewController</span> : <span class="title">UIViewController</span>, <span class="title">GreetingView</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> presenter: <span class="type">GreetingViewPresenter</span>!</div><div class="line">    <span class="keyword">let</span> showGreetingButton = <span class="type">UIButton</span>()</div><div class="line">    <span class="keyword">let</span> greetingLabel = <span class="type">UILabel</span>()</div><div class="line"> </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="keyword">self</span>.showGreetingButton.addTarget(<span class="keyword">self</span>, action: <span class="string">"didTapButton:"</span>, forControlEvents: .<span class="type">TouchUpInside</span>)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didTapButton</span><span class="params">(button: UIButton)</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.presenter.showGreeting()</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setGreeting</span><span class="params">(greeting: String)</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.greetingLabel.text = greeting</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">// 布局代码</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//  MVP</span></div><div class="line"><span class="keyword">let</span> model = <span class="type">Person</span>(firstName: <span class="string">"David"</span>, lastName: <span class="string">"Blaine"</span>)</div><div class="line"><span class="keyword">let</span> view = <span class="type">GreetingViewController</span>()</div><div class="line"><span class="keyword">let</span> presenter = <span class="type">GreetingPresenter</span>(view: view, person: model)</div><div class="line">view.presenter = presenter</div></pre></td></tr></table></figure>
<p>我们不希望 View 和 Model 之间有任何联系， 所以 ViewController（实际上是 View ）中不应该处理这种协调逻辑。</p>
<p>我们评估下之前提出的架构特点：</p>
<ol>
<li>职能均分：分隔的很清楚。</li>
<li>容易测试：确实易于测试。</li>
<li>易用，维护成本低：这个实例的代码量是 MVC 的两倍。换句话说，使用 MVP 意味着代码量大。</li>
</ol>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/Pattern-MVC/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/Pattern-MVC/" itemprop="url">
                  iOS 架构模式之 MVC
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-02T00:00:00+08:00">
                2017-03-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>注1：本文中实例引述自<a href="https://medium.com/ios-os-x-development/ios-architecture-patterns-ecba4c38de52" target="_blank" rel="external">《iOS Architecture Patterns》</a>。</p>
<p>注2：本系列从 M、V、C 角色定义以及数据流向的层面探讨架构设计。</p>
<h2 id="为什么要考虑架构模式"><a href="#为什么要考虑架构模式" class="headerlink" title="为什么要考虑架构模式"></a>为什么要考虑架构模式</h2><p>如果不关心架构模式，总有一天，你的一个复杂类会变得无比庞大，你会发现很难修改这个类的功能，无法快速的定位 bug。</p>
<p>一个优秀的架构应该具备以下几个特点：</p>
<ol>
<li>职能均衡的划分给具有清晰角色的功能类（雨露均沾）。</li>
<li>容易测试（往往得益于第一点）</li>
<li>易用，方便维护。</li>
</ol>
<h3 id="为什么要划分职能"><a href="#为什么要划分职能" class="headerlink" title="为什么要划分职能"></a>为什么要划分职能</h3><p>当我们理解事物的时候，划分职能让我们的大脑清晰的思考。如果你认为不断的写代码，你的大脑就能习惯复杂的思维，是这样的。但是，这种思维能力并不是线性增长的，而且很快会到达瓶颈。所以，能够解决复杂问题的简单的方法就是：遵循<a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E4%B8%80%E5%8A%9F%E8%83%BD%E5%8E%9F%E5%88%99" target="_blank" rel="external">单一功能原则</a> ，将职能划分给不同的功能类。</p>
<h3 id="为什么要易用"><a href="#为什么要易用" class="headerlink" title="为什么要易用"></a>为什么要易用</h3><p>易用和易维护是针对团队而言的。团队成员要对架构模式达成共识，这样才能快速有效的进行开发和 Debug。在一个准备使用一个看上去很棒的解决方案时也要考虑它的维护成本。</p>
<h2 id="主流架构模式"><a href="#主流架构模式" class="headerlink" title="主流架构模式"></a>主流架构模式</h2><p>目前几种主流的架构设计模式：</p>
<ul>
<li>MVC</li>
<li>MVP</li>
<li>MVVM</li>
<li>VIPER</li>
</ul>
<p>架构模式没有教科书式的标准答案，关键在于架构师和团队成员达成一致认识，在遇到问题时不断的调整，跨越瓶颈。</p>
<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><h3 id="苹果的-MVC"><a href="#苹果的-MVC" class="headerlink" title="苹果的 MVC"></a>苹果的 MVC</h3><p>这里我们说得 MVC 特指苹果推荐的 MVC 模式，如图：</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNbRwgy1fd8kdc6dzjj30go06fgly.jpg" alt=""></p>
<p>Controller 介于 View 和 Model 之间， View 和 Model 没有任何直接联系。Model 包含了数据模型，以及管理这些数据相关的逻辑计算，如本地数据变化、数据缓存等。</p>
<p>这种模式很直接，并且易学。这种模式看上去很美好，但现实中，这个模式往往变成了这样的：</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNbRwgy1fd8kkfmsc7j30m8074mxt.jpg" alt=""></p>
<p>因为 Controller 包含了 ViewController 的生命周期和布局代码，很难说 View 和 Controller 是相互独立的。并且 Controller 处于桥接位置，很容易成一个可以处理任何事情的容器，变得臃肿无比。这样的 Controller 之中会有大量的 “表示逻辑”(presentation logic)，就是那些将 Model 数据转换为 View 可以呈现的东西的事情，例如将一个 NSDate 转换为一个格式化过的 NSString，或者讲几个字符串拼接以便于显示的逻辑。</p>
<h3 id="违背-MVC-的日常代码"><a href="#违背-MVC-的日常代码" class="headerlink" title="违背 MVC 的日常代码"></a>违背 MVC 的日常代码</h3><p>经常会看到这样的代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> userCell = tableView.dequeueReusableCellWithIdentifier(<span class="string">"identifier"</span>) <span class="keyword">as</span> <span class="type">UserCell</span></div><div class="line">userCell.configureWithUser(user)</div></pre></td></tr></table></figure>
<p>这个 cell（View）直接调用了 Model，实际上已经违背了 MVC 模型的规则，但这种情况很普遍，以至于人们不觉得这里有什么不对。如果严格遵守 MVC 的话，要把对 cell 的配置放在 Controller 中，而不是向 cell（View） 传递一个 Model 对象。当然这会让 Controller 的体积变得更庞大。</p>
<h3 id="MVC-实例"><a href="#MVC-实例" class="headerlink" title="MVC 实例"></a>MVC 实例</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span> </span>&#123; <span class="comment">// Model</span></div><div class="line">    <span class="keyword">let</span> firstName: <span class="type">String</span></div><div class="line">    <span class="keyword">let</span> lastName: <span class="type">String</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingViewController</span> : <span class="title">UIViewController</span> </span>&#123; <span class="comment">// View + Controller</span></div><div class="line">    <span class="keyword">var</span> person: <span class="type">Person</span>!</div><div class="line">    <span class="keyword">let</span> showGreetingButton = <span class="type">UIButton</span>()</div><div class="line">    <span class="keyword">let</span> greetingLabel = <span class="type">UILabel</span>()</div><div class="line"> </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="keyword">self</span>.showGreetingButton.addTarget(<span class="keyword">self</span>, action: <span class="string">"didTapButton:"</span>, forControlEvents: .<span class="type">TouchUpInside</span>)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">didTapButton</span><span class="params">(button: UIButton)</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> greeting = <span class="string">"Hello"</span> + <span class="string">" "</span> + <span class="keyword">self</span>.person.firstName + <span class="string">" "</span> + <span class="keyword">self</span>.person.lastName</div><div class="line">        <span class="keyword">self</span>.greetingLabel.text = greeting</div><div class="line"> </div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 布局代码</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// MVC</span></div><div class="line"><span class="keyword">let</span> model = <span class="type">Person</span>(firstName: <span class="string">"David"</span>, lastName: <span class="string">"Blaine"</span>)</div><div class="line"><span class="keyword">let</span> controller = <span class="type">GreetingViewController</span>()</div><div class="line">controller.person = model;</div></pre></td></tr></table></figure>
<p>我们评估下之前提出的架构特点：</p>
<ol>
<li>职能均分：View 和 Controller 紧密耦合。</li>
<li>容易测试：紧密耦合不利于测试。</li>
<li>易用，维护成本低：这种模式在语言框架层就得到了苹果的支持，新手容易上手，相比其他模式代码量少，开发速度快。但随着项目变大，由于其耦和度很高，可维护性越来越差。</li>
</ol>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/iOS-CommonLibs-Objc/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/iOS-CommonLibs-Objc/" itemprop="url">
                  iOS 开发常用第三方库 [Objective-C 版]
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-01T00:00:00+08:00">
                2017-03-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href=""></a></p>
<ul>
<li><p>网络</p>
<ul>
<li><a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="external">AFNetworking</a> 强大的网络基础库</li>
<li><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a> 网络图片下载、缓存、展示。支持UIImageView category</li>
<li><a href="https://github.com/robbiehanson/CocoaAsyncSocket" target="_blank" rel="external">CocoaAsyncSocket</a> 异步 socket 网络库</li>
</ul>
</li>
<li><p>图片</p>
<ul>
<li><a href="https://github.com/BradLarson/GPUImage" target="_blank" rel="external">GPUImage</a> 基于 GPU 处理图片与视频</li>
<li><a href="https://github.com/path/FastImageCache" target="_blank" rel="external">FastImageCache</a> 高效的图片缓存库</li>
<li><a href="https://github.com/Flipboard/FLAnimatedImage" target="_blank" rel="external">FLAnimatedImage</a> GIF引擎</li>
</ul>
</li>
<li><p>布局</p>
<ul>
<li><a href="https://github.com/SnapKit/Masonry" target="_blank" rel="external">Masonry</a>  对AutoLayout 进行了封装，提供了更优雅的链式语法</li>
</ul>
</li>
</ul>
<ul>
<li><p>数据</p>
<ul>
<li><a href="https://github.com/ccgus/fmdb" target="_blank" rel="external">fmdb</a> 用 Objective-C 封装的 SQLite</li>
<li><a href="https://github.com/magicalpanda/MagicalRecord" target="_blank" rel="external">MagicalRecord</a> 神奇的 Core Data 封装</li>
<li><a href="https://github.com/realm/realm-cocoa" target="_blank" rel="external">realm-cocoa</a> 移动数据库，可以代替 Core Data &amp; SQLite</li>
</ul>
</li>
<li><p>Model</p>
<ul>
<li><a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a> JSON Model 转换</li>
<li><a href="https://github.com/RestKit/RestKit" target="_blank" rel="external">RestKit</a> JSON Model 转换</li>
<li><a href="https://github.com/jsonmodel/jsonmodel" target="_blank" rel="external">jsonmodel</a> JSON Model 转换</li>
</ul>
</li>
<li><p>动态方案</p>
<ul>
<li><a href="https://github.com/bang590/JSPatch" target="_blank" rel="external">JSPatch</a> JSPatch bridge Objective-C and Javascript using the Objective-C runtime</li>
</ul>
</li>
<li><p>日志</p>
<ul>
<li><a href="https://github.com/CocoaLumberjack/CocoaLumberjack" target="_blank" rel="external">CocoaLumberjack</a> 日志输出工具</li>
</ul>
</li>
<li>其他<ul>
<li><a href="https://github.com/ViccAlexander/Chameleon" target="_blank" rel="external">Chameleon</a> 扁平颜色库</li>
<li><a href="https://github.com/hackiftekhar/IQKeyboardManager" target="_blank" rel="external">IQKeyboardManager</a> 处理键盘弹出收起</li>
<li><a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="external">WebViewJavascriptBridge</a> UIWebViews 中 Objective-C and JavaScript 桥接</li>
<li><a href="https://github.com/Flipboard/FLEX" target="_blank" rel="external">FLEX</a> UI 分析工具</li>
<li><a href="https://github.com/forkingdog/UITableView-FDTemplateLayoutCell" target="_blank" rel="external">UITableView-FDTemplateLayoutCell</a> TableViewCell 高度计算</li>
<li><a href="https://github.com/facebook/KVOController" target="_blank" rel="external">KVOController</a> KVO 监听</li>
<li><a href="https://github.com/nst/iOS-Runtime-Headers" target="_blank" rel="external">iOS-Runtime-Headers</a> Runtime 工具</li>
</ul>
</li>
</ul>
<ul>
<li><p>UI控件</p>
<ul>
<li>提示<ul>
<li><a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external">MBProgressHUD</a> 各种样式的提示框</li>
<li><a href="https://github.com/SVProgressHUD/SVProgressHUD" target="_blank" rel="external">SVProgressHUD</a> 简单轻量级的加载提示</li>
</ul>
</li>
<li>刷新<ul>
<li><a href="https://github.com/CoderMJLee/MJRefresh" target="_blank" rel="external">MJRefresh</a> 培训界的最爱</li>
</ul>
</li>
<li>轮播 <ul>
<li><a href="https://github.com/nicklockwood/iCarousel" target="_blank" rel="external">iCarousel</a></li>
</ul>
</li>
<li>界面<ul>
<li><a href="https://github.com/jessesquires/JSQMessagesViewController" target="_blank" rel="external">JSQMessagesViewController</a> 一个优雅的消息（IM）UI库</li>
<li><a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="external">DZNEmptyDataSet</a> 列表页为空时的提示页</li>
<li><a href="https://github.com/mwaterfall/MWPhotoBrowser]" target="_blank" rel="external">MWPhotoBrowser</a> 图片浏览器</li>
</ul>
</li>
<li><p>图表</p>
<ul>
<li><a href="https://github.com/kevinzhow/PNChart" target="_blank" rel="external">PNChart</a> 柱状图，饼状图等</li>
<li><a href="https://github.com/MatthewYork/DateTools" target="_blank" rel="external">DateTools</a> 日历工具</li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li><a href="https://github.com/facebook/Shimmer" target="_blank" rel="external">Shimmer</a> 闪烁效果</li>
<li><a href="https://github.com/CEWendel/SWTableViewCell" target="_blank" rel="external">SWTableViewCell</a>  UITableViewCell 滑动功能按钮</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-6/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-6/" itemprop="url">
                  AsyncDisplayKit 教程(6)：多方向的智能预加载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T00:00:00+08:00">
                2017-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="多方向的智能预加载"><a href="#多方向的智能预加载" class="headerlink" title="多方向的智能预加载"></a>多方向的智能预加载</h2><p>ASDK 支持多方向的智能预加载。也就是说可以在垂直方向上滚动 table，当 cell 来到屏幕上的某个位置时，cell 会包含一个水平滚动的 Collection View。</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79ly1fd3mf2sxc6g30i20bau13.gif" alt=""></p>
<p>虽然 Collection View 明显已经位于可见区域，但你并不想将整个 Collection View 都加载。为此，你可以让每个 Scroll View 分别拥有各自的 ASRangeController，每个 ASRangeController 的 Range Tuning Parameters 是分开配置的。</p>
<p>现在你已经完成了 AnimalTableController，你可以把它作为 ASPageNode 中的一页来使用。</p>
<p>打开 AppDelegate.m，将这句代码:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AnimalTableController *vc = [[AnimalTableController alloc] initWithAnimals:[RainforestCardInfo allAnimals]];</div></pre></td></tr></table></figure>
<p>替换为</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AnimalPagerController *vc = [[AnimalPagerController alloc] init];</div></pre></td></tr></table></figure>
<p>然后打开 AnimalPagerController.m 在构造函数中 return 语句之前加入代码。你所需要做的仅仅是创建一个新的 pager，并将它作为 View Controller 的数据源：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_pagerNode = [[ASPagerNode alloc] init];</div><div class="line">_pagerNode.dataSource = <span class="keyword">self</span>;</div></pre></td></tr></table></figure>
<p>Pager Node 实际上是一个配置好的 ASCollectionNode 子类，这和 UIPageViewController 的用法是一样的。</p>
<p>接下来你必须实现 Pager 的数据源方法。</p>
<p>实现 <code>numberOfPagesInPagerNode:</code>  方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSInteger</span>)numberOfPagesInPagerNode:(ASPagerNode *)pagerNode &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.animals.count;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现 <code>pagerNode:nodeAtIndex:</code>方法，这和早先你实现过的 ASTableNode 方法很像：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (ASCellNode *)pagerNode:(ASPagerNode *)pagerNode nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</div><div class="line">  <span class="comment">//1</span></div><div class="line">  <span class="built_in">NSArray</span> *animals = <span class="keyword">self</span>.animals[index];</div><div class="line"></div><div class="line">  <span class="comment">//2</span></div><div class="line">  ASCellNode *node = [[ASCellNode alloc] initWithViewControllerBlock:^&#123;</div><div class="line">    <span class="keyword">return</span> [[AnimalTableController alloc] initWithAnimals:animals];</div><div class="line">  &#125; didLoadBlock:<span class="literal">nil</span>];</div><div class="line"></div><div class="line">  <span class="keyword">return</span> node;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码解释如下：</p>
<ol>
<li>需要先获取一个数据模型。</li>
<li>你用到的是强大的 <code>initWithViewControllerBlock:</code> 构造方法。你需要提供一个闭包，在这个块闭包中返回你前面已经做好的 Table Node Controller，这样它的 View 会自动用作每一页的 View。酷！</li>
</ol>
<p>这样就拥有一个完整的 Pager 了，它的 cell 来自于你前面完成的那个 Table Node Controller。它拥有二维的预加载，用户可以从水平、垂直两个方向滚动。   </p>
<h2 id="总述"><a href="#总述" class="headerlink" title="总述"></a>总述</h2><p>完整的 AsyncDisplayKit 2.0 教程项目，从<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/AsyncDisplayKit-Finished-3.zip" target="_blank" rel="external">这里</a>下载。如果你想看 Swift 版的，也可以从<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/RainForestSwift.zip" target="_blank" rel="external">这里</a>下载。</p>
<p>如果在进入第二部分之前想学习更多的内容，你可以浏览 AsyncDisplayKit 的官方主页，并查看它的文档。Scott Goodson (AsyncDisplayKit 的原作者) 也会发表一些你感兴趣的文字，它们按时间顺序罗列在这个地方：<a href="http://asyncdisplaykit.org/docs/resources.html" target="_blank" rel="external">AsyncDisplayKit.org Resources</a>。</p>
<p>你可能会对 <a href="https://www.youtube.com/watch?v=OiY1cheLpmI" target="_blank" rel="external">Building Paper 大事记</a> 感兴趣。尽管它还没有被开源，并且还有许多东西会变化，但在它才开始的时候就关注它仍然是一件很有意思的事情。                   </p>
<p>接下来，我们会讲到，如何利用 ASDK 2.0 强大的布局系统。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-5/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-5/" itemprop="url">
                  AsyncDisplayKit 教程(5)：智能预加载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-27T00:00:00+08:00">
                2017-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="预加载的使用"><a href="#预加载的使用" class="headerlink" title="预加载的使用"></a>预加载的使用</h3><p>你可能曾经写过这样的 App ：根据 ScrollView /PageView 的滚动来提前加载数据。比如一个全屏的图片浏览器，总是提前加载下几张图片，这样你的用户基本不会看到空白图片。 如果你想写这样一个程序，你会发现需要考虑的东西太多了。</p>
<p>之前我们说， ASRangeController 会魔法，现在我们解释一下。</p>
<p>在每个容器类中，每个 node 都会有一个“界面状态”的概念。在任何给定的时刻，一个 node 都会处于下列状态：</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79ly1fd33jhb46qj30fy0zuahb.jpg" alt=""></p>
<ul>
<li>Preload Range: 这个位置距离“可见”最远。这时 cell 中的所有 subnode 的内容，比如 ASNetworkImageNode 需要从外部数据源、API 或本地缓存中下载内容。以 batch fetching 为例，这个时候应当抓取模型对象。</li>
<li>Display Range: 处于这个位置的时候，将进行显示操作，比如绘制文本和图片解码。</li>
<li>Visible Range: 处于这个位置的时候，node 至少在屏幕上有一个像素。</li>
</ul>
<p>这些 Range 都能以“整屏”的方式度量，还可以轻易地通过 ASRangeTuningParameters 属性进行调整。</p>
<p>例如，如果你用一个 ASNetworkImageNode 来显示一页图片。当每一页进入 Preload Range 位置时，都要从网络请求数据，而当它进入 Display Range 位置时又会对已经下载的图片进行解码。</p>
<p>通常，如果你不愿意，你可以不考虑这些 Range。它们已经内置了，比如 ASNetworkImageNode 和 ASTextNode。</p>
<h3 id="Node-界面状态-Callbacks"><a href="#Node-界面状态-Callbacks" class="headerlink" title="Node 界面状态 Callbacks"></a>Node 界面状态 Callbacks</h3><p>每个 node 都有一个 interfaceState 属性，它是一个 “bitfield” (NS_OPTION) 类型 ASInterfaceState。因为 ASCellNode 在 Scroll View 中滚动时，Scroll View 是受 ASRangeController 管理的，每个subnode 都会适时改变它的 interfaceState 属性。这样，即使层次最深的那个 node 也可以根据 interfaceState 的改变做出反应。</p>
<p>幸运的是，几乎不需要直接操纵 node 的 interfaceState 属性。通常，需要对节点的状态改变进行响应即可。也就是所谓的 界面状态 Callbacks。</p>
<h4 id="对-node-进行命名"><a href="#对-node-进行命名" class="headerlink" title="对 node 进行命名"></a>对 node 进行命名</h4><p>为了明白节点的状态是怎样变化的，我们需要给它命名。这样，你就可以看到节点是什么时候加载数据，显示内容，进入屏幕，以及它离开时的逆过程。</p>
<p>找到 <code>tableNode:nodeBlockForRowAtIndexPath:</code> 方法中的这个注释：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//You'll add something extra here later...</span></div></pre></td></tr></table></figure>
<p>在注释的下面，加入下句，给每个 cell 一个 debugName 值。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cardNode.debugName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"cell %zd"</span>, indexPath.row];</div></pre></td></tr></table></figure>
<p>现在可以跟踪到每个 cell 进入不同范围的变化过程。</p>
<h4 id="观察-Cell"><a href="#观察-Cell" class="headerlink" title="观察 Cell"></a>观察 Cell</h4><p>打开 CardNode_InterfaceCallbacks.m。这里有 6 个方法，这些方法用来打印节点进入各种范围的过程。取消注释，运行程序，慢慢滚动界面。同时，观察 cell 状态的改变。</p>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79ly1fd340ce8e8g30da09y7wl.gif" alt=""></p>
<p>注意：大部分情况下，你只需要用到两个关于 ASInterfaceState 的改变方法：<code>didEnterVisibleState</code> 和 <code>didExitVisibleState</code>。也就是说，大量底层的工作已经为你完成了。要想知道什么时候需要用到 Preload 和 Display 状态，请看 ASNetworkImageNode 的源代码。所有的 Network Image Node 都会自动抓取和解码，以及释放内存。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-4/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-4/" itemprop="url">
                  AsyncDisplayKit 教程(4)：Batch Fetching
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T00:00:00+08:00">
                2017-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用-Batch-Fetching-进行无限滚动"><a href="#使用-Batch-Fetching-进行无限滚动" class="headerlink" title="使用 Batch Fetching 进行无限滚动"></a>使用 Batch Fetching 进行无限滚动</h3><p>每个 App 都会采用某些机制，保证用户浏览到当前列表结尾时，可以从服务器上拉取新的数据。通常通过 ScrollView 的 delegate 方法 <code>scrollViewDidScroll:</code>  监听 content<br> offset 来进行处理。在 ASDK 中，只需要指定：需要提前多少页时请求数据。</p>
<p>取消 AnimalTableController.m 中 Helpers 类别中的两个方法注释。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AnimalTableController</span> (<span class="title">Helpers</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)retrieveNextPageWithCompletion:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span> *))block &#123;</div><div class="line">  <span class="built_in">NSArray</span> *moreAnimals = [[<span class="built_in">NSArray</span> alloc] initWithArray:[<span class="keyword">self</span>.animals subarrayWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">5</span>)] copyItems:<span class="literal">NO</span>];</div><div class="line">  </div><div class="line">  <span class="comment">// Important: this block must run on the main thread</span></div><div class="line">  <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">    block(moreAnimals);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)insertNewRowsInTableNode:(<span class="built_in">NSArray</span> *)newAnimals &#123;</div><div class="line">  <span class="built_in">NSInteger</span> section = <span class="number">0</span>;</div><div class="line">  <span class="built_in">NSMutableArray</span> *indexPaths = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">  </div><div class="line">  <span class="built_in">NSUInteger</span> newTotalNumberOfPhotos = <span class="keyword">self</span>.animals.count + newAnimals.count;</div><div class="line">  <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> row = <span class="keyword">self</span>.animals.count; row &lt; newTotalNumberOfPhotos; row++) &#123;</div><div class="line">    <span class="built_in">NSIndexPath</span> *path = [<span class="built_in">NSIndexPath</span> indexPathForRow:row inSection:section];</div><div class="line">    [indexPaths addObject:path];</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  [<span class="keyword">self</span>.animals addObjectsFromArray:newAnimals];</div><div class="line">  [<span class="keyword">self</span>.tableNode insertRowsAtIndexPaths:indexPaths withRowAnimation:<span class="built_in">UITableViewRowAnimationNone</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>retrieveNextPageWithCompletion:</code> 方法中可以进行网络调用，而 <code>insertNewRowsInTableNode:</code> 将新的数据添加到 table 中。</p>
<p>在 <code>viewDidLoad:</code> 方法中加入：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableNode.view.leadingScreensForBatching = <span class="number">1.0</span>;  <span class="comment">// 默认值是 2.0</span></div></pre></td></tr></table></figure>
<p>将 leadingScreensForBatching 设置为 1.0 表示当用户滚动还剩 1 个全屏就到达页尾时，开始抓取新的一批数据。</p>
<p>在 Delegate 类别中加入这个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)shouldBatchFetchForTableNode:(ASTableNode *)tableNode &#123;</div><div class="line">  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个方法告诉表格，在这次批抓取之后是否还可以进行新的批抓取。如果你知道 API 上的数据什么时候结束，返回 NO，表示不用进行新的批抓取了。</p>
<p>然后，继续加入：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)tableNode:(ASTableNode *)tableNode willBeginBatchFetchWithContext:(ASBatchContext *)context &#123;</div><div class="line">  <span class="comment">//1</span></div><div class="line">  [<span class="keyword">self</span> retrieveNextPageWithCompletion:^(<span class="built_in">NSArray</span> *animals) &#123;</div><div class="line">    <span class="comment">//2</span></div><div class="line">    [<span class="keyword">self</span> insertNewRowsInTableNode:animals];</div><div class="line"></div><div class="line">    <span class="comment">//3</span></div><div class="line">    [context completeBatchFetching:<span class="literal">YES</span>];</div><div class="line">  &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个方法在用户即将滚动到 table 末尾并且 <code>shouldBatchFetchForTableNode:</code> 方法返回 YES 时被调用。<br>代码解释：</p>
<ol>
<li>请求一次新批抓取，以备显示。通常这会从 API 返回一个对象数组。</li>
<li>在完成块中，用新数据刷新表格。</li>
<li>调用 <code>completeBatchFetching:</code> ，YES 表示你已经完成这个批次。在本批次抓取完成之前，不会进行新的批次抓取。</li>
</ol>
<p>运行程序，可以无限滚动。 </p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-3/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-3/" itemprop="url">
                  AsyncDisplayKit 教程(3)：TableNode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-25T00:00:00+08:00">
                2017-02-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本教程的初始工程 RainforestStarter 可以点<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/AsyncDisplayKit-Starter-3.zip" target="_blank" rel="external">这里</a>获取。</p>
<p>运行程序，App 中包含了一个 UITableView，显示了一个野生动物的列表。滚动页面，帧率开始下降。这个 App 明显的需要进行性能上调优。</p>
<h3 id="用-TableNode-替换-Table-View"><a href="#用-TableNode-替换-Table-View" class="headerlink" title="用 TableNode 替换 Table View"></a>用 TableNode 替换 Table View</h3><p>在 AnimalTableController.m 中引入 AsyncDisplayKit：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;AsyncDisplayKit/AsyncDisplayKit.h&gt;</span></span></div></pre></td></tr></table></figure>
<p>将 tableView 属性声明：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UITableView</span> *tableView;</div></pre></td></tr></table></figure>
<p>替换为 tableNode:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) ASTableNode *tableNode;</div></pre></td></tr></table></figure>
<p>这会导致许多代码出现错误，这些错误会引导你去完成整个转换。</p>
<p>我们需要将所有的 tableView 实例修改为 tableNode，其中注意这些地方：</p>
<ol>
<li>将一个 ASTableNode 实例分配给 tableNode。</li>
<li>ASTableNode 对象没有 <code>registerCalss: forCellReuseIdentifier</code> 方法。</li>
<li>你不能将 node 添加为一个 subview。</li>
</ol>
<p>将 <code>viewDidLoad</code> 方法修改为：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.tableNode = [[ASTableNode alloc]initWithStyle:<span class="built_in">UITableViewStylePlain</span>];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.view addSubnode:<span class="keyword">self</span>.tableNode];</div><div class="line">    [<span class="keyword">self</span> wireDelegation];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> applyStyle];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里，我们调用它了 UIVIew 的 <code>addSubnode:</code> 方法，这个方法是通过 Category 的方式被添加到 UIView 上的。它实际上等于：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.tableNode.view];</div></pre></td></tr></table></figure>
<p>修改 <code>viewWillLayoutSubviews</code> 方法，将 self.tableView 替换为 self.tableNode :</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewWillLayoutSubviews &#123;</div><div class="line">  [<span class="keyword">super</span> viewWillLayoutSubviews];</div><div class="line"></div><div class="line">  <span class="keyword">self</span>.tableNode.frame = <span class="keyword">self</span>.view.bounds;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>修改 <code>applyStyle</code> 方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)applyStyle &#123;</div><div class="line">  <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</div><div class="line">  <span class="keyword">self</span>.tableNode.view.separatorStyle = <span class="built_in">UITableViewCellSeparatorStyleNone</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了设置 tableView 的 separatorStyle 属性，我们必须访问 tableNode 的 view 属性。ASTableNode 并没有将 UITableView 的所有属性都暴露出来，因此为了访问 UITableView 的某些属性，你必须访问位于 TableNode 底下的 UITableView 对象。</p>
<h3 id="设置-TableNote-的-Data-Source-amp-Delegate"><a href="#设置-TableNote-的-Data-Source-amp-Delegate" class="headerlink" title="设置 TableNote 的 Data Source &amp; Delegate"></a>设置 TableNote 的 Data Source &amp; Delegate</h3><p>和 UITableView 一样，ASTableNode 也有 Data Source 和 Delegate。TableNode 的 ASTableDataSource 和 ASTableDelegate 协议和 UITableViewDataSource 和 UITableViewDelegate 协议非常相似。</p>
<p>将 <code>wireDelegation</code>方法中的 tableView 修改为 tableNode</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)wireDelegation &#123;</div><div class="line">  <span class="keyword">self</span>.tableNode.dataSource = <span class="keyword">self</span>;</div><div class="line">  <span class="keyword">self</span>.tableNode.delegate = <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>并且让 controller 遵守 ASTableDataSource 和 ASTableDelegate 协议。</p>
<h4 id="实现-ASTableDataSource-协议"><a href="#实现-ASTableDataSource-协议" class="headerlink" title="实现 ASTableDataSource 协议"></a>实现 ASTableDataSource 协议</h4><p>首先，将 UITableViewDataSource 方法 <code>tableView:numberOfRowsInSection:</code> 修改为 ASTableDataSource 协议的版本。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSInteger</span>)tableNode:(ASTableNode *)tableNode numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>.animals.count;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后，ASTableNodes 返回 cell 的方式和 UITableView 有所不同。将 <code>tableView:cellForRowAtIndexPath:</code>方法替换为:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1</span></div><div class="line">- (ASCellNodeBlock)tableNode:(ASTableView *)tableView nodeBlockForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</div><div class="line">  <span class="comment">//2</span></div><div class="line">  RainforestCardInfo *animal = <span class="keyword">self</span>.animals[indexPath.row];</div><div class="line"></div><div class="line">  <span class="comment">//3</span></div><div class="line">  <span class="keyword">return</span> ^&#123;</div><div class="line">    <span class="comment">//4</span></div><div class="line">    CardNode *cardNode = [[CardNode alloc] initWithAnimal:animal];</div><div class="line"></div><div class="line">    <span class="comment">//You'll add something extra here later...</span></div><div class="line">    <span class="keyword">return</span> cardNode;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码解释：</p>
<ol>
<li>ASCellNode 等价于 UITableViewCell 或 UICollectionViewCell。注意这个方法返回的是一个 ASCellNodeBlock。因为一个 ASTableNode 在内部维护了所有的 cell，为每个 cell 的 Index Path 指定了一个 block，这样就能够并发的初始化所有的 cell。</li>
<li>得到一个数据模型对象。闭包会捕捉到这个对象。IndexPath 不需要在闭包中使用，有可能在闭包调用前数据会发生改变。</li>
<li>闭包中返回的类型必须是 ASCellNode。</li>
<li>不需要关心 cell 重用的问题，因此只需要实例化一个 cell。注意，你返回的是一个 CardNode 而不是 CardCell。</li>
</ol>
<h4 id="实现-ASTableDelegate-协议"><a href="#实现-ASTableDelegate-协议" class="headerlink" title="实现 ASTableDelegate 协议"></a>实现 ASTableDelegate 协议</h4><p>在使用 UITableView 的时候通常都需要实现 <code>tableView:heightForRowAtIndexPath:</code> 方法来计算每个 cell 的高度。</p>
<p>ASTableDelegate 中没有 <code>tableView:heightForRowAtIndexPath:</code> 方法。如果使用 ASDK, 所有的 ASCellNodes 都自己负责计算它们的大小。不需要提供一个固定的高度，你可以为每个 cell 指定一个最大尺寸和最小尺寸。这个例子中，你需要让每个 cell 至少占据屏幕 2/3 的高度。</p>
<p>将 -tableView:heightForRowAtIndexPath: 方法替换为:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-(ASSizeRange)tableNode:(ASTableNode *)tableNode constrainedSizeForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="built_in">CGFloat</span> width = [<span class="built_in">UIScreen</span> mainScreen].bounds.size.width;</div><div class="line">    <span class="built_in">CGSize</span> min = <span class="built_in">CGSizeMake</span>(width, ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.height/<span class="number">3</span>) * <span class="number">2</span>);</div><div class="line">    <span class="built_in">CGSize</span> max = <span class="built_in">CGSizeMake</span>(width, INFINITY);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> ASSizeRangeMake(min, max);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>搞定！ 运行一下，很流畅~</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://swift.diagon.me/AsyncDisplayKit-2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="万恶胖为首">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Swift学徒">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Swift学徒" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/AsyncDisplayKit-2/" itemprop="url">
                  AsyncDisplayKit 教程(2)：ASDisplayNode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-24T00:00:00+08:00">
                2017-02-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ASDisplayNode"><a href="#ASDisplayNode" class="headerlink" title="ASDisplayNode"></a>ASDisplayNode</h2><p>ASDisplayNode 是 ASDK 的核心类。</p>
<p>我们知道 UIView 是对 CALayer 的一个封装，添加了触摸事件的处理以及其他功能。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fd2tzeu6aej30i208mq3r.jpg" alt=""></p>
<p>ASDisplayNode 也使用了这种抽象。你可以认为 Node 包含了一个 View，就像 View 包含了一个 Layer。</p>
<p>Node 可以在后台队列中创建和配置，默认情况使用异步渲染。</p>
<p><img src="https://ww1.sinaimg.cn/large/006tNc79ly1fd2u1q81jbj30qo08ymx8.jpg" alt=""></p>
<p>Node 的 API 和 UIView 的难以置信的相似：所有的 View 属性都可以在 node 上找到相同的。你还可访问底层的 view 或 layer，就像你可以访问 UIView的 .layer 一样。</p>
<h2 id="Node-Containers"><a href="#Node-Containers" class="headerlink" title="Node Containers"></a>Node Containers</h2><p>Node 与四个容器类中的一个结合使用时，就产生魔法般的性能提升。</p>
<p>这四个类包含：</p>
<ul>
<li>ASViewController:  UIViewController 子类，允许你创建节点并进行管理。</li>
<li>ASCollectionNode 和 ASTableNode:  UICollectionView 和 UITableView 对应的 Node 类。</li>
<li>ASPagerNode:  ASCollectionNode 子类，和 UIPageViewController 相比，提供了很棒的 swiping 性能。</li>
</ul>
<p>真正的魔法来自于： ASRangeController，这 4 个类都会通过它来影响所包含的 node 的行为。这个后面再讲。</p>
<hr>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="万恶胖为首" />
          <p class="site-author-name" itemprop="name">万恶胖为首</p>
          <p class="site-description motion-element" itemprop="description">笨办法学Swift</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/rss.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">万恶胖为首</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
  

  

  

  

  


</body>
</html>
